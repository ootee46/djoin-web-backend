<form #myForm="ngForm" [formGroup]="dataForm" class="flex flex-col h-full" (submit)="saveData()">
    <mat-toolbar matDialogTitle class="mat-accent m-0">
        <mat-toolbar-row clas="flex flex-row w-full">
            <span class="title dialog-title flex-1">{{dialogTitle}}</span>
            <button class="items-end" type="button" mat-icon-button (click)="close()" aria-label="Close dialog">
                <mat-icon class="icon-size-5 cursor-pointer material-symbols-outlined">close</mat-icon>
            </button>
        </mat-toolbar-row>
    </mat-toolbar>
    <div mat-dialog-content class="p-4 m-0 flex-1 flex flex-col">
        <div class="flex flex-row gap-4">
            <mat-form-field class="fuse-mat-no-subscript flex-1">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status">
                    <mat-option [value]="'New'">New</mat-option>
                    <mat-option [value]="'Inprogress'">InProgress</mat-option>
                    <mat-option [value]="'Pending'">Pending</mat-option>
                    <mat-option [value]="'Completed'">Completed</mat-option>
                </mat-select>
            </mat-form-field>
            <date-input [displayText]="'Start Date'"  [rangeDate]="dataForm.get('endDate').value" [rangeType]="'start'"  formControlName="startDate" [required]="true" class="w-60"></date-input>
            <date-input [displayText]="'Target Date'"  [rangeDate]="dataForm.get('startDate').value" [rangeType]="'end'"   formControlName="endDate" [required]="true" class="w-60"></date-input>
        </div>
        <mat-form-field class="fuse-mat-no-subscript mt-4">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" maxlength="900">
        </mat-form-field>
        <mat-form-field class="fuse-mat-no-subscript mt-4">
            <mat-label>Content</mat-label>
            <textarea matInput formControlName="detail"></textarea>
        </mat-form-field>
        <mat-form-field class="fuse-mat-no-subscript mt-4">
            <mat-label>Remark</mat-label>
            <input matInput formControlName="remark" maxlength="900">
        </mat-form-field>
        <mat-form-field class="fuse-mat-no-subscript mt-4">
            <mat-label>Sender</mat-label>
            <input matInput formControlName="sender" maxlength="900">
        </mat-form-field>
        <div class="mt-8 border-b mb-2 font-medium">Assignees</div>
        <div class="flex flex-row gap-4 mt-2 items-center justify-center">
            <search-option  *ngIf="(filterAttendees$ | async) as attendees" class="flex-1"
            [value]="'userId'"
            [text]="'fullName'"
            [options$]="filterAttendees$"
            [(ngModel)]="selectedAttendee"
            [ngModelOptions]="{standalone: true}"
            [displayText]="'Select Assignees'"></search-option>
            <div><button type="button" (click)="addAttendee()" class="" mat-raised-button color="primary">Add</button></div>
        </div>
        <div class="">
            <ng-container *ngIf="selectedAttendees">
                <ng-container *ngIf="selectedAttendees.length > 0; else noDatas">
                    <div class="grid">
                        <div class="z-10 sticky top-0 grid  style1-grid gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                            <div>
                                Action
                            </div>
                            <div>
                                Name
                            </div>
                        </div>
                        <ng-container *ngFor="let data of selectedAttendees; ">
                            <div class="style1-grid grid items-center gap-4 w-full py-2 px-6  border-b">
                                <div>
                                    <button type="button" (click)="deleteAttendee(data.userId)">
                                        <mat-icon tile="Delete" class="material-symbols-outlined mt-1">delete</mat-icon>
                                    </button>
                                </div>
                                <div class="truncate">
                                    {{data.fullName}}
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
        </div>

        <div class="mt-8 border-b mb-2 font-medium">Meeting Documents (.png, .jpg, .pdf, .docx, .xlsx, .pptx &lt;= 50Mb)</div>
        <div class="flex flex-row gap-4 mt-2 items-center justify-center">
            <file-input [displayText]="''" [limitSize]="50" [acceptFile]="'.png,.jpg,.pdf,.docx,.xlsx,.pptx'" [(ngModel)]="selectedAttachment" [ngModelOptions]="{standalone: true}" class="flex-1"></file-input>
            <div><button type="button" (click)="addAttachment()"  mat-raised-button color="primary">Add</button></div>
        </div>
        <div class="mt-4">
            <ng-container *ngIf="attachments">
                <ng-container *ngIf="attachments.length > 0; else noDatas">
                    <div class="grid">
                        <div class="z-10 sticky top-0 grid  style1-grid gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                            <div>
                                Action
                            </div>
                            <div>
                                File Name
                            </div>

                        </div>
                        <ng-container *ngFor="let data of attachments; ">
                            <div class="style1-grid grid items-center gap-4 w-full py-2 px-6  border-b">
                                <div>
                                    <button type="button" (click)="deleteAttachment(data)" >
                                        <mat-icon tile="Delete" class="material-symbols-outlined mt-1">delete</mat-icon>
                                    </button>
                                </div>
                                <div class="truncate">
                                    <a  [openFile]="data" class="underline cursor-pointer">{{data.fileName}}</a>
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
        </div>

        
        <!-- <div class="flex flex-auto overflow-hidden mt-4 relative">
            <div class="flex flex-col flex-auto mb-0 overflow-y-auto">
                <ng-container *ngIf="(adminUsers$ | async) as adminUsers">
                    <ng-container *ngIf="adminUsers.length > 0; else noDatas">
                        <div class="grid ">
                            <div class="z-10 sticky top-0 grid  meeting-invitation-form-grid gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                                <div>
                                    <mat-checkbox></mat-checkbox>
                                </div>
                                <div>
                                    Name
                                </div>
                                <div>
                                    Email
                                </div>
                            </div>
                            <ng-container *ngFor="let data of adminUsers">
                                <div class="meeting-invitation-form-grid grid items-center gap-4 w-full py-2 px-6  border-b">
                                    <div>
                                        <mat-checkbox></mat-checkbox>
                                    </div>
                                    <div class="truncate">
                                        {{data.fullName}}
                                    </div>
                                    <div class="truncate">
                                        {{data.email}}
                                    </div>
                                </div>
                            </ng-container>
                        </div>
                    </ng-container>
                </ng-container>
                <ng-template #noDatas>
                    <div class="p-8  border-t font-semibold tracking-tight text-center">Record not found!</div>
                </ng-template>
            </div>
        </div> -->
    </div>
    <div mat-dialog-actions class="m-0 py-2 px-4 mat-primary bg-gray-100">
        <button (click)="saveData()" mat-raised-button color="primary" class="save-button mat-accent" [disabled]="dataForm.invalid">
            <span *ngIf="!dataForm.disabled">
               Submit
            </span>
            <mat-progress-spinner *ngIf="dataForm.disabled" [diameter]="24" [mode]="'indeterminate'"></mat-progress-spinner>
        </button>
    </div>
    <ng-template #noDatas>
        <div class="p-4 border-t font-semibold tracking-tight text-center">Record not found!</div>
    </ng-template>
</form>
