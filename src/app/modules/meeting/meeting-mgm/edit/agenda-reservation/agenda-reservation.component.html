<mat-drawer-container  class="sm:absolute sm:inset-0 flex flex-col flex-auto min-w-0 sm:overflow-hidden bg-card">
    <div class="relative flex flex-col gap-4 sm:flex-row flex-0 sm:items-center sm:justify-end pt-4 px-6 border-b" *ngIf="(listData$ | async) as listData">
        <div *ngIf="listData.length > 0"><button type="button" (click)="export()" mat-raised-button color="primary" class="mb-4"> Export Data </button></div>
    </div>
    <div class="h-full overflow-hidden">
        <div class="flex h-full flex-col flex-auto sm:mb-18 overflow-auto">
            <ng-container *ngIf="(listData$ | async) as listData">
                <ng-container *ngIf="listData.length > 0; else noDatas">
                    <div class="grid">
                        <div class="z-10 sticky top-0 grid
                        grid-cols-[140px_minmax(200px,_1fr)_minmax(200px,_1fr)_120px_140px]
                        gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                            <div>
                                Request No
                            </div>
                            <div>
                                Agenda
                            </div>
                            <div>
                                Requester
                            </div>
                            <div>
                                Request Date
                            </div>
                            <div>
                                Current Status
                            </div>
                        </div>
                        <ng-container *ngFor="let data of listData; ">
                            <div class=" grid
                            grid-cols-[140px_minmax(200px,_1fr)_minmax(200px,_1fr)_120px_140px]
                            items-center gap-4 w-full py-2 px-6  border-b cursor-pointer hover:bg-gray-100 " (click)="viewDetal(data)" >
                                <div>
                                    {{data.documentNo}}
                                </div>
                                <div>
                                    {{data.title}}
                                </div>
                                <div>
                                    {{data.requesterName}}
                                </div>
                                <div class="text-center">
                                    {{data.submittedDate | date : 'dd/MM/yyyy HH:mm'}}
                                </div>
                                <div>
                                    {{data.approveStatus}}
                                </div>
                            </div>
                        </ng-container>
                    </div>
                </ng-container>
            </ng-container>
            <ng-template #noDatas>
                <div class="p-8 sm:p-16 font-semibold tracking-tight text-center">Record not found!</div>
            </ng-template>
            <ng-template #emptyData>
                <div class="font-semibold tracking-tight text-center">No Data.</div>
            </ng-template>
        </div>
    </div>
    <mat-drawer class="w-11/12" [autoFocus]="false" [mode]="'over'" [position]="'end'" [opened]="false" #matDrawer>
        <div class="px-6 py-2" >
            <div class="flex-1 flex-auto overflow-auto">
                <div class="m-4">
                    <div class="p-4 rounded-2xl bg-gray-50 border  mb-6">
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Request No.:</div>
                            <div class="flex-1">{{data.documentNo}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Meeting Name:</div>
                            <div class="flex-1">{{data.meetingTitle}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Meeting Date:</div>
                            <div class="flex-1">{{data.startDate | date : "dd-MM-yyyy"}}  {{data.startDate | date : "HH:mm"}}  <span *ngIf="data.endDate"> - {{data.endDate | date : "HH:mm"}} </span></div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Agenda Name:</div>
                            <div class="flex-1">{{data.title}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Objective:</div>
                            <div class="flex-1">{{data.agendaObjectiveName}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Confidential Level:</div>
                            <div class="flex-1">{{data.agendaConfidentialName}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Request Date:</div>
                            <div class="flex-1">{{data.createdDate | date : 'dd/MM/yyyy HH:mm'}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Agenda Status:</div>
                            <div class="flex-1">{{data.approveStatus}}</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Require Voting:</div>
                            <div class="flex-1" *ngIf="data.isVote === true">Yes</div>
                            <div class="flex-1" *ngIf="data.isVote === false">No</div>
                        </div>
                        <div class="flex flex-row gap-4 mb-2">
                            <div class="w-40 font-semibold">Vote Open:</div>
                            <div class="flex-1" *ngIf="data.isVoteOpen === true">Yes</div>
                            <div class="flex-1" *ngIf="data.isVoteOpen === false">No</div>
                        </div>
                    </div>
                    <div class="p-0 mb-6">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <div class="flex-1">
                                <div class="p-2 bg-gray-100 font-semibold border">Booking Detail</div>
                                <div class="flex flex-col p-4 border-x border-b overflow-hidden  bg-white">
                                    <div class="overflow-auto">
                                        <ng-container *ngIf="isBookingDetail">
                                            <ng-container *ngIf="bookingDetail; else emptyData">
                                                <div class="flex flex-wrap gap-4">
                                                    {{bookingDetail}}
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-0 mb-6">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4">
                            <div class="flex-1">
                                <div class="flex-1">
                                    <div class="p-2 bg-gray-100 font-semibold border">Related Booking</div>
                                    <div class="flex flex-col p-4 border-x border-b overflow-hidden  bg-white">
                                        <div class="overflow-auto">
                                            <ng-container *ngIf="isRelationBookingPanel">
                                                <ng-container *ngIf="relation.length > 0; else noDatas">
                                                    <ng-container *ngFor="let item of relation; ">
                                                        <div class="p-4 rounded-2xl bg-gray-50 border mb-2" style="flex: 1 1 calc(50% - 1rem); max-width: calc(50% - 1rem);">
                                                            <div class="flex flex-row gap-4 mb-2">
                                                                <div class="w-40 font-semibold">Request No.:</div>
                                                                <div class="flex-1">{{item.requestNo}}</div>
                                                            </div>
                                                            <div class="flex flex-row gap-4 mb-2">
                                                                <div class="w-40 font-semibold">Meeting Name:</div>
                                                                <div class="flex-1">{{item.meetingName}}</div>
                                                            </div>
                                                            <div class="flex flex-row gap-4 mb-2">
                                                                <div class="w-40 font-semibold">Meeting Date:</div>
                                                                <div class="flex-1">{{item.startDate | date : "dd/MM/yyyy"}} {{item.startDate | date : "HH:mm"}} <span *ngIf="item.endDate"> - {{item.endDate | date : "HH:mm"}} </span></div>
                                                            </div>
                                                            <div class="flex flex-row gap-4 mb-2">
                                                                <div class="w-40 font-semibold">Objective:</div>
                                                                <div class="flex-1">{{item.objective}}</div>
                                                            </div>
                                                            <div class="flex flex-row gap-4 mb-2">
                                                                <div class="w-40 font-semibold">Confidential Level:</div>
                                                                <div class="flex-1">{{item.confidential}}</div>
                                                            </div>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                            </ng-container>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="p-0 mb-6">
                        <div class="flex flex-col sm:flex-row gap-4 mb-4  ">
                            <div class="flex-1">
                                <div class="p-2 bg-gray-100 font-semibold border"> Presenters</div>
                                <div class="flex flex-col p-4 border-x border-b overflow-hidden  bg-white">
                                    <div class="overflow-auto">
                                        <ng-container *ngIf="presenters">
                                            <ng-container *ngIf="presenters.length > 0; else emptyData">
                                                <div *ngFor="let item of presenters;let index = index ">{{(index + 1)}}. {{item.name}}</div>
                                            </ng-container>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-1">
                                <div class="p-2 bg-gray-100 font-semibold border"> Exclude Attendee</div>
                                <div class="p-4 border-x border-b flex flex-col overflow-hidden  bg-white">
                                    <div class="overflow-auto">
                                        <ng-container *ngIf="excludeUsers.length > 0; else emptyData">
                                            <div *ngFor="let item of excludeUsers;let index = index ">{{(index + 1)}}. {{item.name}}</div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-8 border-b mb-2 font-medium">Presenters Documents</div>
                    <div class="mt-4 mb-6">
                        <ng-container *ngIf="data.presenterAttachments">
                            <ng-container *ngIf="data.presenterAttachments.length > 0; else noDatas">
                                <div class="grid">
                                    <div class="grid grid-cols-[minmax(160px,_1fr)_160px_120px] z-10 sticky top-0 gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                                        <div
                                        class="flex items-center gap-2 cursor-pointer"
                                        (click)="setPresentersSort('fileName')"
                                    >
                                        File Name
                                            <mat-icon
                                                class="material-symbols-outlined icon-size-4"
                                            >
                                                {{
                                                    sortPresenters.sort === "asc" && sortPresenters.fieldName === 'fileName'
                                                        ? "arrow_upward"
                                                        : "arrow_downward"
                                                }}
                                            </mat-icon>
                                    </div>
                                    <div
                                        class="flex items-center gap-2 cursor-pointer"
                                        (click)="setPresentersSort('updatedUser')"
                                    >
                                        Uploaded By
                                            <mat-icon
                                                class="material-symbols-outlined icon-size-4"
                                            >
                                                {{
                                                    sortPresenters.sort === "asc" && sortPresenters.fieldName === 'updatedUser'
                                                        ? "arrow_upward"
                                                        : "arrow_downward"
                                                }}
                                            </mat-icon>
                                    </div>
                                    <div
                                        class="flex items-center gap-2 cursor-pointer"
                                        (click)="setPresentersSort('updatedDate')"
                                    >
                                        Uploaded Date
                                            <mat-icon
                                                class="material-symbols-outlined icon-size-4"
                                            >
                                                {{
                                                    sortPresenters.sort === "asc" && sortPresenters.fieldName === 'updatedDate'
                                                        ? "arrow_upward"
                                                        : "arrow_downward"
                                                }}
                                            </mat-icon>
                                    </div>
                                    </div>
                                    <ng-container
                                    *ngFor="
                                        let item of sortArrayByField(
                                            data.presenterAttachments,
                                            sortPresenters.fieldName,
                                            sortPresenters.sort
                                        )
                                    "
                                    >
                                        <div class="grid grid-cols-[minmax(160px,_1fr)_160px_120px] items-center gap-4 w-full py-2 px-6  border-b">
                                            <div class="truncate">
                                                <a  [openFile]="item" class="underline cursor-pointer">{{item.fileName}}</a>
                                            </div>
                                            <div class="truncate">
                                                {{item.updatedUser}}
                                            </div>
                                            <div class="truncate">
                                                {{item.updatedDate | date : 'dd/MM/yyyy HH:mm'}}
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </ng-container>
                        </ng-container>
                    </div>
                    <div class="mt-8 border-b mb-2 font-medium">Attachements</div>
                    <div class="mt-4">
                        <ng-container *ngIf="data.attachments">
                            <ng-container *ngIf="data.attachments.length > 0; else noDatas">
                                <div class="grid">
                                    <div class="grid grid-cols-[50px_minmax(160px,_1fr)_200px_160px_120px] z-10 sticky top-0 gap-4 py-2 px-6 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5" >
                                        <div>
                                            Action
                                        </div>
                                        <div
                                    class="flex items-center gap-2 cursor-pointer"
                                    (click)="setAttachmentsSort('fileName')"
                                >
                                    File Name
                                        <mat-icon
                                            class="material-symbols-outlined icon-size-4"
                                        >
                                            {{
                                                sortAttachments.sort === "asc" && sortAttachments.fieldName === 'fileName'
                                                    ? "arrow_upward"
                                                    : "arrow_downward"
                                            }}
                                        </mat-icon>
                                </div>
                                <div
                                    class="flex items-center gap-2 cursor-pointer"
                                    (click)="
                                        setAttachmentsSort('documentTypeName')
                                    "
                                >
                                    Document Type
                                        <mat-icon
                                            class="material-symbols-outlined icon-size-4"
                                        >
                                            {{
                                                sortAttachments.sort === "asc" && sortAttachments.fieldName === 'documentTypeName'
                                                    ? "arrow_upward"
                                                    : "arrow_downward"
                                            }}
                                        </mat-icon>
                                </div>
                                <div
                                    class="flex items-center gap-2 cursor-pointer"
                                    (click)="setAttachmentsSort('updatedUser')"
                                >
                                    Uploaded By
                                        <mat-icon
                                            class="material-symbols-outlined icon-size-4"
                                        >
                                            {{
                                                sortAttachments.sort === "asc" && sortAttachments.fieldName === 'updatedUser'
                                                    ? "arrow_upward"
                                                    : "arrow_downward"
                                            }}
                                        </mat-icon>
                                </div>
                                <div
                                    class="flex items-center gap-2 cursor-pointer"
                                    (click)="setAttachmentsSort('updatedDate')"
                                >
                                    Uploaded Date
                                        <mat-icon
                                            class="material-symbols-outlined icon-size-4"
                                        >
                                            {{
                                                sortAttachments.sort === "asc" && sortAttachments.fieldName === 'updatedDate'
                                                    ? "arrow_upward"
                                                    : "arrow_downward"
                                            }}
                                        </mat-icon>
                                </div>
                                    </div>
                                    <div>
                                        <ng-container
                                        *ngFor="
                                        let item of sortArrayByField(
                                            data.attachments,
                                            sortAttachments.fieldName,
                                            sortAttachments.sort
                                        )
                                    ">
                                            <div class="grid grid-cols-[50px_minmax(160px,_1fr)_200px_160px_120px] items-center gap-4 w-full py-0 px-6  border-b bg-white" cdkDrag>
                                                <div>
                                                    <button mat-icon-button type="button" [matMenuTriggerFor]="moreMenu" aria-label="More" (click)="$event.stopPropagation();">
                                                        <mat-icon class="material-symbols-outlined">more_vert</mat-icon>
                                                    </button>
                                                    <mat-menu #moreMenu="matMenu">
                                                        <button type="button" mat-menu-item (click)="openPermission(item)"><mat-icon class="material-symbols-outlined">lock</mat-icon> View Permission</button>
                                                        <mat-divider></mat-divider>
                                                    </mat-menu>
                                                </div>
                                                <div class="truncate">
                                                    <a  [openFile]="item" class="underline cursor-pointer">{{item.fileName}}</a>
                                                </div>
                                                <div>{{item.documentTypeName}}</div>
                                                <div class="truncate">
                                                    {{item.updatedUser}}
                                                </div>
                                                <div class="truncate">
                                                    {{item.updatedDate | date : 'dd/MM/yyyy HH:mm'}}
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </div>
                    <div class="mt-8 border-b mb-2 font-medium">History</div>
                    <div class="mb-8" *ngIf="data.approvers">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-100">
                                    <td class="text-center">Description</td>
                                    <td class="text-center w-36">Date</td>
                                    <td class="text-center w-60">Action By</td>
                                    <td class="text-center w-36">Status</td>
                                    <td class="text-center">Remark</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of data.approvers">
                                    <td>{{item.stepName}}</td>
                                    <td><span *ngIf="item.actionDate">{{item.actionDate | date : "dd/MM/yyyy HH:mm"}}</span></td>
                                    <td>{{item.approverName}}</td>
                                    <td>{{item.action}}</td>
                                    <td>{{item.remark}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </mat-drawer>
</mat-drawer-container>
